<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-9VTJR4ZW26"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-9VTJR4ZW26');
    </script>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Practice Letters - My Nihongo Path</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link rel="icon" type="image/x-icon" href="images/siteIcoRed.png">
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@400;500;700;900&display=swap" rel="stylesheet" />
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        "primary": "#ee2b3b",
                        "background-light": "#fcf8f8",
                        "brand-dark": "#1b0d0f",
                        "brand-subtle": "#f3e7e8",
                        "muted-indigo": "#5C6784"
                    },
                    fontFamily: { "display": ["Lexend", "sans-serif"] },
                    borderRadius: { "DEFAULT": "1rem", "lg": "1.5rem" }
                }
            }
        };
    </script>
    <style>
        body {
            font-family: 'Lexend', sans-serif;
        }
    </style>
</head>

<body class="bg-background-light font-display">
    <div class="min-h-screen px-4 sm:px-10 lg:px-20 xl:px-40 py-8 flex justify-center">
        <div class="w-full max-w-[900px] flex flex-col gap-6">
            <header class="flex items-center justify-between border-b border-brand-subtle pb-4">
                <h1 class="text-brand-dark text-2xl font-black">Letter Practice</h1>
                <a href="javascript:history.back()" class="text-muted-indigo hover:text-primary">Back</a>
            </header>

            <div class="bg-sakura-pink/40 border border-brand-subtle rounded-lg p-4">
                <h2 class="text-brand-dark font-bold">Instructions</h2>
                <ul class="text-muted-indigo list-disc pl-6">
                    <li>Use your physical notebook to write answers.</li>
                    <li>A 5-second countdown starts first.</li>
                    <li>Each selected letter shows Romaji and Sinhala for 10 seconds.</li>
                    <li>Write the Hiragana letter that matches them.</li>
                </ul>
            </div>

            <!-- HTML status section -->
            <div id="status" class="text-center">
                <div id="startPanel" class="mb-4">
                    <button id="startBtn"
                        class="rounded-full bg-primary text-white font-bold px-6 py-3 text-lg hover:bg-primary/90">
                        START
                    </button>
                    <p class="text-muted-indigo text-sm mt-2">Click START to begin 5s countdown</p>
                </div>
                <div id="preCountdown" class="hidden text-primary text-5xl font-black tracking-tight"></div>
                <div id="wordPanel" class="hidden">
                    <div class="text-muted-indigo text-sm mb-2" id="progress"></div>
                    <div class="bg-white rounded-lg border border-brand-subtle shadow-sm p-8">
                        <div class="text-5xl font-black text-brand-dark mb-2" id="english"></div>
                        <div class="text-2xl font-bold text-muted-indigo" id="sinhala"></div>
                        <div class="mt-4 text-primary text-2xl font-bold">
                            <span id="wordTimer">10</span>s remaining
                        </div>
                    </div>
                </div>
                <div id="donePanel" class="hidden">
                    <p class="text-brand-dark text-xl font-bold">All done! Great job.</p>
                    <div class="mt-3">
                        <button onclick="location.reload()"
                            class="rounded-full bg-primary text-white font-bold px-5 py-2 hover:bg-primary/90">Practice
                            Again</button>
                    </div>
                    <div class="mt-6 text-left">
                        <h3 class="text-brand-dark font-bold">Letters Practiced</h3>
                        <ul id="shownList" class="mt-2 grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3">
                            <!-- Filled by script in the order shown -->
                        </ul>
                    </div>
                </div>
                <div id="emptyPanel" class="hidden">
                    <p class="text-brand-dark">No letters selected. Please go back and choose a set.</p>
                    <div class="mt-3">
                        <a href="javascript:history.back()" class="text-primary hover:underline">Go Back</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-white border-t border-gray-100 pt-8 pb-8 mt-12 w-full">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex flex-col md:flex-row justify-between items-center gap-4 text-sm text-gray-400">
                <p>&copy; 2025 My Nihongo Path. All rights reserved.</p>
                <p class="flex items-center gap-1">
                    Designed & Developed by
                    <a href="https://www.linkedin.com/in/yigeenula" target="_blank"
                        class="text-gray-600 hover:text-primary font-semibold transition-colors">Yasiru Isum Geenula</a>
                    <span class="mx-2">|</span>
                    <a href="https://codexblaze.online/" target="_blank"
                        class="text-gray-600 hover:text-primary font-semibold transition-colors">CodeXBlaze</a>
                </p>
            </div>
        </div>
    </footer>

    <script>
        (function () {
            const selected = JSON.parse(localStorage.getItem('practiceLetters') || '[]');

            // Fisherâ€“Yates shuffle to randomize the practice order
            function shuffle(arr) {
                for (let i = arr.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [arr[i], arr[j]] = [arr[j], arr[i]];
                }
                return arr;
            }
            shuffle(selected);

            const preCountdownEl = document.getElementById('preCountdown');
            const wordPanel = document.getElementById('wordPanel');
            const englishEl = document.getElementById('english');
            const sinhalaEl = document.getElementById('sinhala');
            const wordTimerEl = document.getElementById('wordTimer');
            const progressEl = document.getElementById('progress');
            const donePanel = document.getElementById('donePanel');
            const emptyPanel = document.getElementById('emptyPanel');
            const shownListEl = document.getElementById('shownList');
            const startPanel = document.getElementById('startPanel');
            const startBtn = document.getElementById('startBtn');

            const shown = []; // keep practiced words in shown order

            if (!selected.length) {
                emptyPanel.classList.remove('hidden');
                if (startPanel) startPanel.classList.add('hidden');
                return;
            }

            let preCount = 5;
            let idx = 0;
            let perWordLeft = 10;
            let perWordTimer;
            let preCountdownTimer = null;
            let isPreCountdownRunning = false;

            function renderShown() {
                if (!shownListEl) return;
                shownListEl.innerHTML = '';
                shown.forEach(w => {
                    const li = document.createElement('li');
                    li.className = 'flex flex-col items-center bg-white rounded-lg border border-brand-subtle shadow-sm p-3';
                    li.innerHTML = `
                <span class="text-primary font-bold text-3xl">${w.jp || ''}</span>
                <div class="flex gap-2 text-sm mt-1">
                    <span class="text-brand-dark font-bold">${w.en || ''}</span>
                    <span class="text-muted-indigo">|</span>
                    <span class="text-brand-dark">${w.si || ''}</span>
                </div>
            `;
                    shownListEl.appendChild(li);
                });
            }

            function showCountdown() {
                if (isPreCountdownRunning) return;
                isPreCountdownRunning = true;
                preCountdownEl.textContent = preCount;
                preCountdownTimer = setInterval(() => {
                    preCount--;
                    preCountdownEl.textContent = preCount;
                    if (preCount <= 0) {
                        clearInterval(preCountdownTimer);
                        isPreCountdownRunning = false;
                        preCountdownTimer = null;
                        preCountdownEl.classList.add('hidden');
                        startWordCycle();
                    }
                }, 1000);
            }

            function startWordCycle() {
                wordPanel.classList.remove('hidden');
                showWord(idx);
            }

            function showWord(i) {
                if (i >= selected.length) {
                    wordPanel.classList.add('hidden');
                    donePanel.classList.remove('hidden');
                    renderShown();
                    return;
                }
                const w = selected[i];
                // record in randomized order
                shown.push({ jp: w.jp, en: w.en, si: w.si });

                englishEl.textContent = w.en || '';
                sinhalaEl.textContent = w.si || '';
                progressEl.textContent = `Letter ${i + 1} of ${selected.length}`;
                perWordLeft = 10;
                wordTimerEl.textContent = perWordLeft;

                if (perWordTimer) clearInterval(perWordTimer);
                perWordTimer = setInterval(() => {
                    perWordLeft--;
                    wordTimerEl.textContent = perWordLeft;
                    if (perWordLeft <= 0) {
                        clearInterval(perWordTimer);
                        idx++;
                        showWord(idx);
                    }
                }, 1000);
            }

            // Bind START button to begin pre-countdown
            if (startBtn) {
                startBtn.addEventListener('click', () => {
                    startBtn.disabled = true;
                    startPanel.classList.add('hidden');
                    preCount = 5;
                    preCountdownEl.classList.remove('hidden');
                    showCountdown();
                });
            }
        })();
    </script>
</body>

</html>